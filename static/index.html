<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KubeNav - K8s Podè´Ÿè½½ç®¡ç†å·¥å…·</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½®å’ŒåŸºç¡€è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .header-logo {
            font-size: 24px;
            font-weight: 700;
            margin-right: 20px;
        }
        
        .header-version {
            font-size: 14px;
            opacity: 0.8;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background-color: #ef4444;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
        }
        
        /* ä¸»ä½“å†…å®¹åŒºåŸŸ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 260px;
            background-color: white;
            border-right: 1px solid #e2e8f0;
            padding: 24px 0;
            overflow-y: auto;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .nav-section {
            margin-bottom: 32px;
        }
        
        .nav-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 24px 12px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 4px;
        }
        
        .nav-link {
            display: block;
            padding: 12px 24px;
            color: #334155;
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover {
            background-color: #f1f5f9;
            color: #667eea;
        }
        
        .nav-link.active {
            background-color: #f0f4ff;
            color: #667eea;
            border-left-color: #667eea;
        }
        
        /* å³ä¾§å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background-color: #f5f7fa;
        }
        
        /* å†…å®¹æ ‡é¢˜ */
        .content-header {
            margin-bottom: 32px;
        }
        
        .content-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .content-subtitle {
            font-size: 14px;
            color: #64748b;
        }
        
        /* é›†ç¾¤å¡ç‰‡æ ·å¼ */
        .cluster-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .cluster-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .cluster-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        .cluster-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .cluster-name {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
        }
        
        .cluster-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .cluster-status.active {
            background-color: #d1fae5;
            color: #059669;
        }
        
        .cluster-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .info-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }
        
        .info-value {
            font-size: 14px;
            color: #1e293b;
            font-weight: 600;
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .empty-state-description {
            font-size: 14px;
        }
        
        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .loading-spinner {
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æ“ä½œæŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            justify-content: flex-end;
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #5568d3;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: #e2e8f0;
        }
        
        /* è´Ÿè½½ç®¡ç†æ ·å¼ */
        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #2c3e50;
            text-align: left;
            margin-bottom: 30px;
            font-size: 2.2rem;
            font-weight: 600;
        }
        
        h2 {
            color: #34495e;
            margin-bottom: 20px;
            font-size: 1.6rem;
            font-weight: 500;
            border-bottom: 2px solid #e0e6ed;
            padding-bottom: 10px;
        }
        
        /* é€‰æ‹©åŒºåŸŸæ ·å¼ */
        .select-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }
        
        .select-item {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
        }
        
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #fff;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .pod-section {
            margin-top: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        th {
            background-color: #ffc0cb;
            color: #8b4513;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.95rem;
        }
        
        /* é™åˆ¶Podåç§°å®½åº¦å¹¶å…è®¸æ¢è¡Œ */
        td:nth-child(1) {
            max-width: 200px;
            word-wrap: break-word;
            word-break: break-all;
        }
        
        /* ç¡®ä¿æ“ä½œæŒ‰é’®åˆ—ä¸è¢«å‹ç¼© */
        .action-buttons {
            min-width: 150px;
        }
        
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        tr:hover {
            background-color: #f1f5f9;
            transition: background-color 0.2s ease;
        }
        
        /* çŠ¶æ€æ ‡ç­¾æ ·å¼ */
        .status {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.Running {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .status.Pending {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .status.Failed {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .status.Succeeded {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        /* æ“ä½œæŒ‰é’®æ ·å¼ */
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        button.remove {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        button.remove:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        button.restore {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        button.restore:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        /* è¸¢å‡ºè´Ÿè½½çŠ¶æ€æ ·å¼ */
        .has-removeload {
            color: #dc2626;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .no-removeload {
            color: #059669;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .message {
            padding: 16px 20px;
            margin: 10px 0;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .message.success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #059669;
        }
        
        .message.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #dc2626;
        }
        
        /* ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .empty-state small {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* ç”¨æˆ·ç®¡ç†æ ·å¼ */
        /* è¡¨æ ¼æ ·å¼ */
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .user-table th {
            background-color: #667eea;
            color: white;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.95rem;
        }
        
        /* ç®¡ç†æŒ‰é’®æ ·å¼ */
        .manage-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-edit {
            background-color: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-edit:hover {
            background-color: #5568d3;
            transform: translateY(-1px);
        }
        
        .btn-delete {
            background-color: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-delete:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .cluster-section {
                grid-template-columns: 1fr;
            }
            
            .select-section {
                flex-direction: column;
            }
            
            .select-item {
                width: 100%;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            button {
                width: 100%;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="header-left">
            <div class="header-logo">KubeNav</div>
            <div class="header-version">v1.1</div>
        </div>
        <div class="header-right">
                <div class="user-info">
                    <span>ğŸ‘¤</span>
                    <span id="currentUsername">admin</span>
                </div>
                <button id="logoutBtn" class="btn btn-danger">ç™»å‡º</button>
            </div>
    </header>
    
    <!-- ä¸»ä½“å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside class="sidebar">
            <nav>
                <div class="nav-section">
                    <div class="nav-title">æ ¸å¿ƒåŠŸèƒ½</div>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" id="clusterNav">Kubernetesé›†ç¾¤</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" id="loadNav">è´Ÿè½½ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" id="userNav">ç”¨æˆ·ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" id="logNav">æ—¥å¿—ç®¡ç†</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>
        
        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <main class="content">
            <!-- é›†ç¾¤ç®¡ç†å†…å®¹ -->
            <div id="clusterContent" style="display: block;">
                <!-- å†…å®¹æ ‡é¢˜ -->
                <div class="content-header">
                    <h1 class="content-title">Kubernetesé›†ç¾¤</h1>
                    <p class="content-subtitle">ç®¡ç†å’Œç›‘æ§æ‰€æœ‰Kubernetesé›†ç¾¤</p>
                    <div style="margin-top: 16px;">
                        <button class="btn-primary" onclick="addCluster()">æ·»åŠ é›†ç¾¤</button>
                    </div>
                </div>
                
                <!-- é›†ç¾¤åˆ—è¡¨ -->
                <div class="cluster-section" id="clusterSection">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨åŠ è½½é›†ç¾¤åˆ—è¡¨...</p>
                    </div>
                </div>
            </div>
            
            <!-- è´Ÿè½½ç®¡ç†å†…å®¹ -->
            <div id="loadContent" style="display: none;">
                <div class="container">
                    <div class="content-header">
                        <h1 class="content-title">è´Ÿè½½ç®¡ç†</h1>
                        <p class="content-subtitle">ç®¡ç†Kubernetesé›†ç¾¤ä¸­çš„Podè´Ÿè½½</p>
                    </div>
                    
                    <div class="select-section">
                        <div class="select-item">
                            <label for="cluster">K8sé›†ç¾¤</label>
                            <select id="cluster" onchange="loadNamespaces()">
                                <option value="">è¯·é€‰æ‹©é›†ç¾¤</option>
                            </select>
                        </div>
                        
                        <div class="select-item">
                            <label for="namespace">å‘½åç©ºé—´</label>
                            <select id="namespace" onchange="loadWorkloads()">
                                <option value="">è¯·é€‰æ‹©å‘½åç©ºé—´</option>
                            </select>
                        </div>
                        
                        <div class="select-item">
                            <label for="workloadType">å·¥ä½œè´Ÿè½½ç±»å‹</label>
                            <select id="workloadType" onchange="loadWorkloads()">
                                <option value="">å…¨éƒ¨ç±»å‹</option>
                                <option value="deployment">Deployment</option>
                                <option value="statefulset">StatefulSet</option>
                                <option value="daemonset">DaemonSet</option>
                            </select>
                        </div>
                        
                        <div class="select-item">
                            <label for="workload">å·¥ä½œè´Ÿè½½</label>
                            <select id="workload" onchange="loadPods()">
                                <option value="">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pod-section">
                        <h2>Podåˆ—è¡¨</h2>
                        <div id="message"></div>
                        <table id="podTable">
                            <thead>
                                <tr>
                                    <th>Podåç§°</th>
                                    <th>çŠ¶æ€</th>
                                    <th>èŠ‚ç‚¹IP</th>
                                    <th>Pod IP</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>è¿è¡Œæ—¶é—´</th>
                                    <th>æ˜¯å¦å·²è¸¢å‡ºè´Ÿè½½</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="8" style="text-align: center; color: #999;">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½æŸ¥çœ‹Podåˆ—è¡¨</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç†å†…å®¹ -->
            <div id="userContent" style="display: none;">
                <!-- å†…å®¹æ ‡é¢˜ -->
                <div class="content-header">
                    <h1 class="content-title">ç”¨æˆ·ç®¡ç†</h1>
                    <p class="content-subtitle">ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’Œæƒé™</p>
                    <div style="margin-top: 16px;">
                        <button class="btn-primary" onclick="openAddUserModal()">æ·»åŠ ç”¨æˆ·</button>
                    </div>
                </div>
                
                <!-- ç”¨æˆ·åˆ—è¡¨ -->
                <div class="container">
                    <div id="userMessage"></div>
                    <table class="user-table" id="userTable">
                        <thead>
                            <tr>
                                <th>ç”¨æˆ·å</th>
                                <th>ç®¡ç†å‘˜æƒé™</th>
                                <th>è¯»æƒé™</th>
                                <th>å†™æƒé™</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" style="text-align: center; color: #999;">åŠ è½½ç”¨æˆ·åˆ—è¡¨...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ—¥å¿—ç®¡ç†å†…å®¹ -->
            <div id="logContent" style="display: none;">
                <!-- å†…å®¹æ ‡é¢˜ -->
                <div class="content-header">
                    <h1 class="content-title">æ—¥å¿—ç®¡ç†</h1>
                    <p class="content-subtitle">æŸ¥çœ‹å’Œç®¡ç†ç³»ç»Ÿæ“ä½œæ—¥å¿—</p>
                    <div style="margin-top: 16px; display: flex; gap: 16px; align-items: flex-start;">
                        <div>
                            <label for="logActionFilter" style="margin-right: 8px; font-weight: 600;">æ“ä½œç±»å‹:</label>
                            <select id="logActionFilter" onchange="loadLogs()" style="padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px;">
                                <option value="">æ‰€æœ‰æ“ä½œ</option>
                                <option value="login_success">ç™»å½•æˆåŠŸ</option>
                                <option value="login_failed">ç™»å½•å¤±è´¥</option>
                                <option value="logout">ç™»å‡º</option>
                                <option value="remove_load">è¸¢å‡ºè´Ÿè½½</option>
                                <option value="restore_traffic">æ¢å¤æµé‡</option>
                                <option value="add_user">æ·»åŠ ç”¨æˆ·</option>
                                <option value="update_user">æ›´æ–°ç”¨æˆ·</option>
                                <option value="delete_user">åˆ é™¤ç”¨æˆ·</option>
                                <option value="add_cluster">æ·»åŠ é›†ç¾¤</option>
                                <option value="update_cluster">æ›´æ–°é›†ç¾¤</option>
                                <option value="delete_cluster">åˆ é™¤é›†ç¾¤</option>
                            </select>
                        </div>
                        <div style="flex: 1; max-width: 300px; margin-top: 26px;">
                            <input type="text" id="logSearch" placeholder="æœç´¢ç”¨æˆ·å..." onkeyup="handleLogSearch()" style="width: 100%; padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px;">
                        </div>
                        <button class="btn-primary" onclick="loadLogs()" style="margin-top: 24px;">åˆ·æ–°</button>
                    </div>
                </div>
                
                <!-- æ—¥å¿—åˆ—è¡¨ -->
                <div class="container">
                    <div id="logMessage"></div>
                    <table class="user-table" id="logsTable">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>ç”¨æˆ·å</th>
                                <th>æ“ä½œç±»å‹</th>
                                <th>æ“ä½œèµ„æº</th>
                                <th>è¯¦ç»†ä¿¡æ¯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" style="text-align: center; color: #999;">åŠ è½½æ—¥å¿—åˆ—è¡¨...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- æ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡† -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUserModal()">&times;</span>
            <h3 id="userModalTitle">æ·»åŠ ç”¨æˆ·</h3>
            <form id="userForm">
                <input type="hidden" id="editUsername">
                
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å *</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">å¯†ç  * <small>(ç¼–è¾‘æ—¶ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹å¯†ç ï¼Œè¾“å…¥æ–°å¯†ç è¡¨ç¤ºä¿®æ”¹å¯†ç )</small></label>
                    <input type="password" id="password" name="password" placeholder="å¯†ç ">
                </div>
                
                <div class="permissions-section">
                    <div class="permissions-title">å…¨å±€æƒé™è®¾ç½®</div>
                    <div class="permissions-grid">
                        <div class="permission-item">
                            <input type="checkbox" id="adminPermission" name="adminPermission" value="true">
                            <label for="adminPermission">
                                å…¨å±€ç®¡ç†å‘˜æƒé™
                            </label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" id="readPermission" name="readPermission" value="true">
                            <label for="readPermission">
                                å…¨å±€è¯»æƒé™
                            </label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" id="writePermission" name="writePermission" value="true">
                            <label for="writePermission">
                                å…¨å±€å†™æƒé™
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="permissions-section">
                    <div class="permissions-title">é›†ç¾¤æƒé™è®¾ç½®</div>
                    <div id="clusterPermissions" style="margin-bottom: 20px;">
                        <div style="text-align: center; color: #64748b; padding: 20px;">åŠ è½½é›†ç¾¤åˆ—è¡¨ä¸­...</div>
                    </div>
                </div>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" style="background-color: #f5f5f5; color: #333; margin-right: 10px;" onclick="closeUserModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- æ·»åŠ é›†ç¾¤æ¨¡æ€æ¡† -->
    <div id="clusterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeClusterModal()">&times;</span>
            <h3 id="clusterModalTitle">æ·»åŠ é›†ç¾¤</h3>
            <form id="clusterForm">
                <input type="hidden" id="editClusterName">
                
                <div class="form-group">
                    <label for="clusterName">é›†ç¾¤åç§° *</label>
                    <input type="text" id="clusterName" name="clusterName" required>
                </div>
                
                <div class="form-group">
                    <label for="displayName">æ˜¾ç¤ºåç§° *</label>
                    <input type="text" id="displayName" name="displayName" required>
                </div>
                
                <div class="form-group">
                    <label for="kubeconfigContent">Kubeconfigå†…å®¹ *</label>
                    <textarea id="kubeconfigContent" name="kubeconfigContent" rows="10" required placeholder="è¯·ç²˜è´´å®Œæ•´çš„kubeconfigå†…å®¹"></textarea>
                </div>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" style="background-color: #f5f5f5; color: #333; margin-right: 10px;" onclick="closeClusterModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // å½“å‰æ¿€æ´»çš„å†…å®¹æ¨¡å—
        let activeModule = 'cluster';
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ‰€æœ‰é›†ç¾¤
        window.onload = function() {
            initialize();
        };
        
        function initialize() {
            // åˆå§‹åŒ–å¯¼èˆªäº‹ä»¶
            initNavigation();
            
            // åˆå§‹åŒ–è‡ªåŠ¨ç™»å‡º
            initializeAutoLogout();
            
            // åˆå§‹åŒ–å½“å‰ç”¨æˆ·
            getCurrentUser();
            
            // åŠ è½½é»˜è®¤æ¨¡å—å†…å®¹
            loadClusterContent();
        }
        
        // åˆå§‹åŒ–å¯¼èˆª
        function initNavigation() {
            // é›†ç¾¤ç®¡ç†å¯¼èˆª
            document.getElementById('clusterNav').addEventListener('click', function(e) {
                e.preventDefault();
                switchModule('cluster');
            });
            
            // è´Ÿè½½ç®¡ç†å¯¼èˆª
            document.getElementById('loadNav').addEventListener('click', function(e) {
                e.preventDefault();
                switchModule('load');
            });
            
            // ç”¨æˆ·ç®¡ç†å¯¼èˆª
            document.getElementById('userNav').addEventListener('click', function(e) {
                e.preventDefault();
                switchModule('user');
            });
            
            // æ—¥å¿—ç®¡ç†å¯¼èˆª
            document.getElementById('logNav').addEventListener('click', function(e) {
                e.preventDefault();
                switchModule('log');
            });
        }
        
        // åˆ‡æ¢æ¨¡å—
        function switchModule(moduleName) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.getElementById(`${moduleName}Nav`).classList.add('active');
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.getElementById('clusterContent').style.display = 'none';
            document.getElementById('loadContent').style.display = 'none';
            document.getElementById('userContent').style.display = 'none';
            document.getElementById('logContent').style.display = 'none';
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            switch(moduleName) {
                case 'cluster':
                    loadClusterContent();
                    break;
                case 'load':
                    loadLoadContent();
                    break;
                case 'user':
                    loadUserContent();
                    break;
                case 'log':
                    loadLogContent();
                    break;
            }
            
            activeModule = moduleName;
        }
        
        // 10åˆ†é’Ÿä¸æ´»åŠ¨è‡ªåŠ¨ç™»å‡ºåŠŸèƒ½
        let logoutTimer;
        const INACTIVITY_TIMEOUT = 10 * 60 * 1000; // 10åˆ†é’Ÿ

        function initializeAutoLogout() {
            // é‡ç½®å®šæ—¶å™¨
            resetLogoutTimer();

            // ç›‘å¬ç”¨æˆ·æ´»åŠ¨äº‹ä»¶
            const activityEvents = ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'];
            activityEvents.forEach(event => {
                document.addEventListener(event, resetLogoutTimer);
            });
        }

        function resetLogoutTimer() {
            clearTimeout(logoutTimer);
            logoutTimer = setTimeout(autoLogout, INACTIVITY_TIMEOUT);
        }

        function autoLogout() {
            fetch('/api/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(() => {
                // è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = '/login?message=ç”±äºé•¿æ—¶é—´ä¸æ´»åŠ¨ï¼Œæ‚¨å·²è‡ªåŠ¨ç™»å‡º';
            })
            .catch(() => {
                // å³ä½¿è¯·æ±‚å¤±è´¥ï¼Œä¹Ÿè¦è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = '/login?message=ç”±äºé•¿æ—¶é—´ä¸æ´»åŠ¨ï¼Œæ‚¨å·²è‡ªåŠ¨ç™»å‡º';
            });
        }
        
        // åŠ è½½é›†ç¾¤å†…å®¹
        function loadClusterContent() {
            document.getElementById('clusterContent').style.display = 'block';
            loadClusters();
        }
        
        // åŠ è½½é›†ç¾¤åˆ—è¡¨
        function loadClusters() {
            fetch('/api/clusters')
                .then(response => response.json())
                .then(data => {
                    const clusterSection = document.getElementById('clusterSection');
                    
                    if (Array.isArray(data) && data.length > 0) {
                        let clusterHTML = '';
                        data.forEach(cluster => {
                            // ä½¿ç”¨APIè¿”å›çš„çœŸå®é›†ç¾¤ç‰ˆæœ¬
                            const version = cluster.version || 'Unknown';
                            // ç¡¬ç¼–ç çš„æ·»åŠ æ—¶é—´ï¼ˆå®é™…åº”è¯¥ä»é›†ç¾¤é…ç½®æˆ–APIè·å–ï¼‰
                            const addedTime = '2024-12-05 16:00';
                            
                            clusterHTML += `
                                <div class="cluster-card">
                                    <div class="cluster-header">
                                        <div class="cluster-name">${cluster.display_name || cluster.name}</div>
                                        <div class="cluster-status active">æ´»è·ƒ</div>
                                    </div>
                                    <div class="cluster-info">
                                        <div class="info-item">
                                            <span class="info-label">é›†ç¾¤åç§°</span>
                                            <span class="info-value">${cluster.name}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">é›†ç¾¤ç‰ˆæœ¬</span>
                                            <span class="info-value">${version}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">æ·»åŠ æ—¶é—´</span>
                                            <span class="info-value">${addedTime}</span>
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <button class="btn-primary" onclick="viewCluster('${cluster.name}')">æŸ¥çœ‹è¯¦æƒ…</button>
                                        <button class="btn-edit" onclick="editCluster('${cluster.name}')">ç¼–è¾‘</button>
                                        <button class="btn-delete" onclick="deleteCluster('${cluster.name}')">åˆ é™¤</button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        clusterSection.innerHTML = clusterHTML;
                    } else {
                        clusterSection.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“¦</div>
                                <div class="empty-state-title">æš‚æ— é›†ç¾¤</div>
                                <div class="empty-state-description">è¯·æ·»åŠ Kubernetesé›†ç¾¤ä»¥å¼€å§‹ç®¡ç†</div>
                                <div style="margin-top: 20px;">
                                    <button class="btn-primary" onclick="addCluster()">æ·»åŠ é›†ç¾¤</button>
                                </div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    const clusterSection = document.getElementById('clusterSection');
                    clusterSection.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">âŒ</div>
                            <div class="empty-state-title">åŠ è½½å¤±è´¥</div>
                            <div class="empty-state-description">æ— æ³•åŠ è½½é›†ç¾¤åˆ—è¡¨ï¼Œè¯·ç¨åé‡è¯•</div>
                            <div style="margin-top: 20px;">
                                <button class="btn-primary" onclick="loadClusters()">é‡è¯•</button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // é›†ç¾¤æ“ä½œå‡½æ•°
        function viewCluster(clusterName) {
            console.log('æŸ¥çœ‹é›†ç¾¤:', clusterName);
        }
        
        function manageCluster(clusterName) {
            console.log('ç®¡ç†é›†ç¾¤:', clusterName);
        }
        
        // æ‰“å¼€æ·»åŠ é›†ç¾¤æ¨¡æ€æ¡†
        function addCluster() {
            document.getElementById('clusterModalTitle').textContent = 'æ·»åŠ é›†ç¾¤';
            document.getElementById('clusterForm').reset();
            document.getElementById('editClusterName').value = '';
            document.getElementById('clusterModal').style.display = 'block';
        }
        
        // å…³é—­é›†ç¾¤æ¨¡æ€æ¡†
        function closeClusterModal() {
            document.getElementById('clusterModal').style.display = 'none';
        }
        
        // ç¼–è¾‘é›†ç¾¤åŠŸèƒ½
        function editCluster(clusterName) {
            fetch(`/api/admin/clusters/${clusterName}`)
                .then(response => response.json())
                .then(cluster => {
                    document.getElementById('clusterModalTitle').textContent = 'ç¼–è¾‘é›†ç¾¤';
                    document.getElementById('editClusterName').value = cluster.name;
                    document.getElementById('clusterName').value = cluster.name;
                    document.getElementById('clusterName').disabled = true;
                    document.getElementById('displayName').value = cluster.display_name;
                    document.getElementById('kubeconfigContent').value = cluster.kubeconfig_content;
                    document.getElementById('clusterModal').style.display = 'block';
                })
                .catch(error => {
                    alert('åŠ è½½é›†ç¾¤é…ç½®å¤±è´¥: ' + error.message);
                });
        }
        
        // åˆ é™¤é›†ç¾¤åŠŸèƒ½
        function deleteCluster(clusterName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤é›†ç¾¤ "${clusterName}" å—ï¼Ÿ`)) {
                fetch(`/api/admin/clusters/${clusterName}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        // é‡æ–°åŠ è½½é›†ç¾¤åˆ—è¡¨
                        if (activeModule === 'cluster') {
                            loadClusters();
                        }
                        if (activeModule === 'load') {
                            loadClustersForLoad();
                        }
                    } else {
                        alert('åˆ é™¤é›†ç¾¤å¤±è´¥: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('åˆ é™¤é›†ç¾¤å¤±è´¥: ' + error.message);
                });
            }
        }
        
        // é›†ç¾¤è¡¨å•æäº¤å¤„ç†
        document.getElementById('clusterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editClusterName = document.getElementById('editClusterName').value;
            const clusterName = document.getElementById('clusterName').value;
            const displayName = document.getElementById('displayName').value;
            const kubeconfigContent = document.getElementById('kubeconfigContent').value;
            
            // æ„å»ºè¯·æ±‚æ•°æ®
            const requestData = {
                name: clusterName,
                display_name: displayName,
                kubeconfig_content: kubeconfigContent
            };
            
            let url = '/api/admin/clusters';
            let method = 'POST';
            
            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œä½¿ç”¨PUTè¯·æ±‚
            if (editClusterName) {
                url = `/api/admin/clusters/${editClusterName}`;
                method = 'PUT';
            }
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    alert(data.message);
                    closeClusterModal();
                    // é‡æ–°åŠ è½½é›†ç¾¤åˆ—è¡¨
                    if (activeModule === 'cluster') {
                        loadClusters();
                    }
                    if (activeModule === 'load') {
                        loadClustersForLoad();
                        
                    }
                } else {
                    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    alert('æ“ä½œå¤±è´¥: ' + data.message);
                }
            })
            .catch(error => {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            });
        });
        
        // å…³é—­é›†ç¾¤æ¨¡æ€æ¡†æ—¶æ¢å¤è¾“å…¥æ¡†çŠ¶æ€
        function closeClusterModal() {
            document.getElementById('clusterModal').style.display = 'none';
            document.getElementById('clusterName').disabled = false;
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
        window.addEventListener('click', function(event) {
            const clusterModal = document.getElementById('clusterModal');
            if (event.target == clusterModal) {
                closeClusterModal();
            }
        });
        
        // åŠ è½½è´Ÿè½½ç®¡ç†å†…å®¹
        function loadLoadContent() {
            document.getElementById('loadContent').style.display = 'block';
            loadClustersForLoad();
        }
        
        // åŠ è½½é›†ç¾¤åˆ—è¡¨ï¼ˆè´Ÿè½½ç®¡ç†ï¼‰
        function loadClustersForLoad() {
            fetch('/api/clusters')
                .then(response => response.json())
                .then(data => {
                    const clusterSelect = document.getElementById('cluster');
                    clusterSelect.innerHTML = '<option value="">è¯·é€‰æ‹©é›†ç¾¤</option>';
                    data.forEach(cluster => {
                        const option = document.createElement('option');
                        option.value = cluster.name;
                        option.textContent = cluster.display_name || cluster.name;
                        clusterSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    showMessage('åŠ è½½é›†ç¾¤å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        // åŠ è½½å‘½åç©ºé—´åˆ—è¡¨
        function loadNamespaces() {
            const cluster = document.getElementById('cluster').value;
            const namespaceSelect = document.getElementById('namespace');
            const workloadSelect = document.getElementById('workload');
            const podTable = document.getElementById('podTable').getElementsByTagName('tbody')[0];
            
            namespaceSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å‘½åç©ºé—´</option>';
            workloadSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½</option>';
            podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½æŸ¥çœ‹Podåˆ—è¡¨</td></tr>';
            
            if (!cluster) return;
            
            fetch(`/api/${cluster}/namespaces`)
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data)) {
                        // æˆåŠŸè·å–å‘½åç©ºé—´åˆ—è¡¨
                        data.forEach(namespace => {
                            const option = document.createElement('option');
                            option.value = namespace;
                            option.textContent = namespace;
                            namespaceSelect.appendChild(option);
                        });
                    } else if (data.success === false) {
                        // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯ä¿¡æ¯
                        showMessage(data.message, 'error');
                    } else if (data.error) {
                        // æ—§æ ¼å¼çš„é”™è¯¯ä¿¡æ¯
                        showMessage('åŠ è½½å‘½åç©ºé—´å¤±è´¥: ' + data.error, 'error');
                    } else {
                        // å…¶ä»–æ ¼å¼é”™è¯¯
                        showMessage('åŠ è½½å‘½åç©ºé—´å¤±è´¥: è¿”å›æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    }
                })
                .catch(error => {
                    showMessage('åŠ è½½å‘½åç©ºé—´å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        // åŠ è½½å·¥ä½œè´Ÿè½½åˆ—è¡¨
        function loadWorkloads() {
            const cluster = document.getElementById('cluster').value;
            const namespace = document.getElementById('namespace').value;
            const workloadType = document.getElementById('workloadType').value;
            const workloadSelect = document.getElementById('workload');
            const podTable = document.getElementById('podTable').getElementsByTagName('tbody')[0];
            
            workloadSelect.innerHTML = '<option value="">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½</option>';
            podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½æŸ¥çœ‹Podåˆ—è¡¨</td></tr>';
            
            if (!cluster || !namespace) return;
            
            let url = `/api/${cluster}/${namespace}/workloads`;
            if (workloadType) {
                url += `?type=${workloadType}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data)) {
                        data.forEach(workload => {
                            const option = document.createElement('option');
                            option.value = JSON.stringify({name: workload.name, type: workload.type});
                            option.textContent = `${workload.name} (${workload.type})`;
                            workloadSelect.appendChild(option);
                        });
                    } else if (data.success === false) {
                        // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯ä¿¡æ¯
                        showMessage(data.message, 'error');
                    } else if (data.error) {
                        // æ—§æ ¼å¼çš„é”™è¯¯ä¿¡æ¯
                        showMessage('åŠ è½½å·¥ä½œè´Ÿè½½å¤±è´¥: ' + data.error, 'error');
                    } else {
                        // å…¶ä»–æ ¼å¼é”™è¯¯
                        showMessage('åŠ è½½å·¥ä½œè´Ÿè½½å¤±è´¥: è¿”å›æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    }
                })
                .catch(error => {
                    showMessage('åŠ è½½å·¥ä½œè´Ÿè½½å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        // åŠ è½½Podåˆ—è¡¨
        function loadPods() {
            const cluster = document.getElementById('cluster').value;
            const namespace = document.getElementById('namespace').value;
            const workloadOption = document.getElementById('workload').value;
            const podTable = document.getElementById('podTable').getElementsByTagName('tbody')[0];
            
            if (!cluster || !namespace || !workloadOption) {
                podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">è¯·é€‰æ‹©å·¥ä½œè´Ÿè½½æŸ¥çœ‹Podåˆ—è¡¨</td></tr>';
                return;
            }
            
            const workload = JSON.parse(workloadOption);
            
            fetch(`/api/${cluster}/${namespace}/${workload.type}/${workload.name}/pods`)
                .then(response => response.json())
                .then(data => {
                    if (Array.isArray(data)) {
                        if (data.length === 0) {
                            podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">è¯¥å·¥ä½œè´Ÿè½½ä¸‹æ²¡æœ‰Pod</td></tr>';
                            return;
                        }
                        
                        let rows = '';
                        data.forEach(pod => {
                            const hasRemoveload = pod.has_removeload ? '<span class="has-removeload">æ˜¯</span>' : '<span class="no-removeload">å¦</span>';
                            const actionButtons = pod.has_removeload ? 
                                `<button class="restore" onclick="restoreTraffic('${cluster}', '${namespace}', '${pod.name}')">æ¢å¤æµé‡</button>` : 
                                `<button class="remove" onclick="removeLoad('${cluster}', '${namespace}', '${pod.name}')">è¸¢å‡ºè´Ÿè½½</button>`;
                            
                            rows += `
                                <tr>
                                    <td>${pod.name}</td>
                                    <td><span class="status ${pod.status}">${pod.status}</span></td>
                                    <td>${pod.node_ip || '-'}</td>
                                    <td>${pod.pod_ip || '-'}</td>
                                    <td>${pod.created_time || '-'}</td>
                                    <td>${pod.running_time || '-'}</td>
                                    <td>${hasRemoveload}</td>
                                    <td class="action-buttons">${actionButtons}</td>
                                </tr>
                            `;
                        });
                        
                        podTable.innerHTML = rows;
                    } else if (data.success === false) {
                        // æœåŠ¡å™¨è¿”å›äº†é”™è¯¯ä¿¡æ¯
                        showMessage(data.message, 'error');
                        podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">åŠ è½½Podåˆ—è¡¨å¤±è´¥</td></tr>';
                    } else if (data.error) {
                        // æ—§æ ¼å¼çš„é”™è¯¯ä¿¡æ¯
                        showMessage('åŠ è½½Podåˆ—è¡¨å¤±è´¥: ' + data.error, 'error');
                        podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">åŠ è½½Podåˆ—è¡¨å¤±è´¥</td></tr>';
                    } else {
                        // å…¶ä»–æ ¼å¼é”™è¯¯
                        showMessage('åŠ è½½Podåˆ—è¡¨å¤±è´¥: è¿”å›æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                        podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">åŠ è½½Podåˆ—è¡¨å¤±è´¥</td></tr>';
                    }
                })
                .catch(error => {
                    showMessage('åŠ è½½Podåˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                    podTable.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #999;">åŠ è½½Podåˆ—è¡¨å¤±è´¥</td></tr>';
                });
        }
        
        // è¸¢å‡ºè´Ÿè½½
        function removeLoad(cluster, namespace, podName) {
            fetch(`/api/${cluster}/${namespace}/pods/${podName}/remove-load`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message, 'success');
                    loadPods();
                } else {
                    showMessage(data.error || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(error => {
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        // æ¢å¤æµé‡
        function restoreTraffic(cluster, namespace, podName) {
            fetch(`/api/${cluster}/${namespace}/pods/${podName}/restore-traffic`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message, 'success');
                    loadPods();
                } else {
                    showMessage(data.error || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(error => {
                showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
            });
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        }
        
        // åŠ è½½ç”¨æˆ·ç®¡ç†å†…å®¹
        function loadUserContent() {
            document.getElementById('userContent').style.display = 'block';
            loadUsers();
        }
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        function loadUsers() {
            fetch('/api/admin/users')
                .then(response => response.json())
                .then(data => {
                    const userTable = document.getElementById('userTable').getElementsByTagName('tbody')[0];
                    
                    if (Array.isArray(data) && data.length > 0) {
                        let rows = '';
                        data.forEach(user => {
                            rows += `
                                <tr>
                                    <td>${user.username}</td>
                                    <td>${user.permissions.admin ? 'æ˜¯' : 'å¦'}</td>
                                    <td>${user.permissions.read ? 'æ˜¯' : 'å¦'}</td>
                                    <td>${user.permissions.write ? 'æ˜¯' : 'å¦'}</td>
                                    <td class="manage-buttons">
                                        <button class="btn-edit" onclick="openEditUserModal('${user.username}')">ç¼–è¾‘</button>
                                        <button class="btn-delete" onclick="deleteUser('${user.username}')">åˆ é™¤</button>
                                    </td>
                                </tr>
                            `;
                        });
                        userTable.innerHTML = rows;
                    } else {
                        userTable.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æ²¡æœ‰ç”¨æˆ·é…ç½®</td></tr>';
                    }
                })
                .catch(error => {
                    showUserMessage('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                    const userTable = document.getElementById('userTable').getElementsByTagName('tbody')[0];
                    userTable.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥</td></tr>';
                });
        }
        
        // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        function showUserMessage(text, type) {
            const messageDiv = document.getElementById('userMessage');
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        }
        
        // åŠ è½½é›†ç¾¤åˆ—è¡¨ç”¨äºæƒé™è®¾ç½®
        function loadClustersForPermissions() {
            fetch('/api/clusters')
                .then(response => response.json())
                .then(data => {
                    const clusterPermissionsDiv = document.getElementById('clusterPermissions');
                    
                    if (Array.isArray(data) && data.length > 0) {
                        let clusterHTML = '<div class="permissions-grid">';
                        data.forEach(cluster => {
                            clusterHTML += `
                                <div class="permission-item">
                                    <input type="checkbox" id="cluster_${cluster.name}" name="clusterPermission" value="${cluster.name}">
                                    <label for="cluster_${cluster.name}">
                                        ${cluster.display_name || cluster.name}
                                    </label>
                                </div>
                            `;
                        });
                        clusterHTML += '</div>';
                        clusterPermissionsDiv.innerHTML = clusterHTML;
                    } else {
                        clusterPermissionsDiv.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px;">æš‚æ— é›†ç¾¤</div>';
                    }
                })
                .catch(error => {
                    const clusterPermissionsDiv = document.getElementById('clusterPermissions');
                    clusterPermissionsDiv.innerHTML = '<div style="text-align: center; color: #dc2626; padding: 20px;">åŠ è½½é›†ç¾¤åˆ—è¡¨å¤±è´¥</div>';
                });
        }
        
        // æ‰“å¼€æ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡†
        function openAddUserModal() {
            document.getElementById('userModalTitle').textContent = 'æ·»åŠ ç”¨æˆ·';
            document.getElementById('userForm').reset();
            document.getElementById('editUsername').value = '';
            document.getElementById('username').disabled = false;
            document.getElementById('userModal').style.display = 'block';
            loadClustersForPermissions();
        }
        
        // æ‰“å¼€ç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡†
        function openEditUserModal(username) {
            fetch(`/api/admin/users/${username}`)
                .then(response => response.json())
                .then(user => {
                    document.getElementById('userModalTitle').textContent = 'ç¼–è¾‘ç”¨æˆ·';
                    document.getElementById('editUsername').value = user.username;
                    document.getElementById('username').value = user.username;
                    document.getElementById('username').disabled = true;
                    document.getElementById('password').value = '';
                    document.getElementById('adminPermission').checked = user.permissions.admin || false;
                    document.getElementById('readPermission').checked = user.permissions.read || false;
                    document.getElementById('writePermission').checked = user.permissions.write || false;
                    document.getElementById('userModal').style.display = 'block';
                    
                    // åŠ è½½é›†ç¾¤åˆ—è¡¨å¹¶è®¾ç½®ç”¨æˆ·å·²æœ‰çš„é›†ç¾¤æƒé™
                    fetch('/api/clusters')
                        .then(response => response.json())
                        .then(clusters => {
                            const clusterPermissionsDiv = document.getElementById('clusterPermissions');
                            
                            if (Array.isArray(clusters) && clusters.length > 0) {
                                let clusterHTML = '<div class="permissions-grid">';
                                clusters.forEach(cluster => {
                                    const hasPermission = user.permissions.clusters && user.permissions.clusters.includes(cluster.name);
                                    clusterHTML += `
                                        <div class="permission-item">
                                            <input type="checkbox" id="cluster_${cluster.name}" name="clusterPermission" value="${cluster.name}" ${hasPermission ? 'checked' : ''}>
                                            <label for="cluster_${cluster.name}">
                                                ${cluster.display_name || cluster.name}
                                            </label>
                                        </div>
                                    `;
                                });
                                clusterHTML += '</div>';
                                clusterPermissionsDiv.innerHTML = clusterHTML;
                            } else {
                                clusterPermissionsDiv.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px;">æš‚æ— é›†ç¾¤</div>';
                            }
                        })
                        .catch(error => {
                            const clusterPermissionsDiv = document.getElementById('clusterPermissions');
                            clusterPermissionsDiv.innerHTML = '<div style="text-align: center; color: #dc2626; padding: 20px;">åŠ è½½é›†ç¾¤åˆ—è¡¨å¤±è´¥</div>';
                        });
                })
                .catch(error => {
                    showUserMessage('åŠ è½½ç”¨æˆ·é…ç½®å¤±è´¥: ' + error.message, 'error');
                });
        }
        
        // å…³é—­ç”¨æˆ·æ¨¡æ€æ¡†
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            document.getElementById('username').disabled = false;
        }
        
        // ç”¨æˆ·è¡¨å•æäº¤å¤„ç†
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editUsername = document.getElementById('editUsername').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const adminPermission = document.getElementById('adminPermission').checked;
            const readPermission = document.getElementById('readPermission').checked;
            const writePermission = document.getElementById('writePermission').checked;
            
            // æ”¶é›†é€‰ä¸­çš„é›†ç¾¤æƒé™
            const selectedClusters = [];
            const clusterCheckboxes = document.querySelectorAll('input[name="clusterPermission"]:checked');
            clusterCheckboxes.forEach(checkbox => {
                selectedClusters.push(checkbox.value);
            });
            
            // æ„å»ºæƒé™å¯¹è±¡
            const permissions = {
                admin: adminPermission,
                read: readPermission,
                write: writePermission,
                clusters: selectedClusters
            };
            
            // æ„å»ºè¯·æ±‚æ•°æ®
            const requestData = {
                username: username,
                permissions: permissions
            };
            
            // åªæœ‰åœ¨æ·»åŠ ç”¨æˆ·æˆ–ä¿®æ”¹å¯†ç æ—¶æ‰åŒ…å«å¯†ç å­—æ®µ
            if (password || !editUsername) {
                requestData.password = password;
            }
            
            let url = '/api/admin/users';
            let method = 'POST';
            
            if (editUsername) {
                url = `/api/admin/users/${editUsername}`;
                method = 'PUT';
            }
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showUserMessage(data.message, 'success');
                    closeUserModal();
                    loadUsers();
                } else {
                    showUserMessage(data.message, 'error');
                }
            })
            .catch(error => {
                showUserMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            });
        });
        
        // åˆ é™¤ç”¨æˆ·
        function deleteUser(username) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${username}" å—ï¼Ÿ`)) {
                fetch(`/api/admin/users/${username}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showUserMessage(data.message, 'success');
                        loadUsers();
                    } else {
                        showUserMessage(data.message, 'error');
                    }
                })
                .catch(error => {
                    showUserMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                });
            }
        }
        
        // æ—¥å¿—ç®¡ç†ç›¸å…³å˜é‡
        let logsData = [];
        
        // åŠ è½½æ—¥å¿—ç®¡ç†å†…å®¹
        function loadLogContent() {
            document.getElementById('logContent').style.display = 'block';
            loadLogs();
        }
        
        // åŠ è½½æ—¥å¿—åˆ—è¡¨
        function loadLogs() {
            const actionFilter = document.getElementById('logActionFilter').value;
            let url = '/api/admin/logs';
            
            if (actionFilter) {
                url += `?action=${actionFilter}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    logsData = data;
                    displayLogs(data);
                })
                .catch(error => {
                    showLogMessage('åŠ è½½æ—¥å¿—åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                    const logsTable = document.getElementById('logsTable').getElementsByTagName('tbody')[0];
                    logsTable.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">åŠ è½½æ—¥å¿—åˆ—è¡¨å¤±è´¥</td></tr>';
                });
        }
        
        // æ˜¾ç¤ºæ—¥å¿—åˆ—è¡¨
        function displayLogs(logs) {
            const logsTable = document.getElementById('logsTable').getElementsByTagName('tbody')[0];
            
            if (Array.isArray(logs) && logs.length > 0) {
                // æŒ‰æ—¶é—´å€’åºæ’åº
                logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                let rows = '';
                logs.forEach(log => {
                    rows += `
                        <tr>
                            <td>${formatTimestamp(log.timestamp)}</td>
                            <td>${log.username}</td>
                            <td>${formatAction(log.action)}</td>
                            <td>${log.resource || '-'}</td>
                            <td>${log.details || '-'}</td>
                        </tr>
                    `;
                });
                logsTable.innerHTML = rows;
            } else {
                logsTable.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">æ²¡æœ‰æ—¥å¿—è®°å½•</td></tr>';
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // æ ¼å¼åŒ–æ“ä½œç±»å‹
        function formatAction(action) {
            const actionMap = {
                'login_success': 'ç™»å½•æˆåŠŸ',
                'login_failed': 'ç™»å½•å¤±è´¥',
                'logout': 'ç™»å‡º',
                'remove_load': 'è¸¢å‡ºè´Ÿè½½',
                'restore_traffic': 'æ¢å¤æµé‡',
                'add_user': 'æ·»åŠ ç”¨æˆ·',
                'update_user': 'æ›´æ–°ç”¨æˆ·',
                'delete_user': 'åˆ é™¤ç”¨æˆ·',
                'add_cluster': 'æ·»åŠ é›†ç¾¤',
                'update_cluster': 'æ›´æ–°é›†ç¾¤',
                'delete_cluster': 'åˆ é™¤é›†ç¾¤'
            };
            return actionMap[action] || action;
        }
        
        // æ˜¾ç¤ºæ—¥å¿—æ¶ˆæ¯
        function showLogMessage(text, type) {
            const messageDiv = document.getElementById('logMessage');
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 3000);
        }
        
        // å¤„ç†æ—¥å¿—æœç´¢
        function handleLogSearch() {
            const searchTerm = document.getElementById('logSearch').value.toLowerCase();
            
            if (!searchTerm) {
                displayLogs(logsData);
                return;
            }
            
            const filteredLogs = logsData.filter(log => 
                log.username.toLowerCase().includes(searchTerm)
            );
            
            displayLogs(filteredLogs);
        }
        
        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        let currentUserInfo = null;

        function getCurrentUser() {
            fetch('/api/current-user')
                .then(response => response.json())
                .then(data => {
                    currentUserInfo = data;
                    // æ›´æ–°æ˜¾ç¤ºçš„ç”¨æˆ·å
                    document.getElementById('currentUsername').textContent = data.username;
                })
                .catch(error => {
                    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                });
        }
        
        // ç™»å‡ºåŠŸèƒ½
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/login';
                    } else {
                        alert('ç™»å‡ºå¤±è´¥: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('ç™»å‡ºå¤±è´¥: ' + error.message);
                });
            }
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
        window.onclick = function(event) {
            const userModal = document.getElementById('userModal');
            if (event.target == userModal) {
                closeUserModal();
            }
        };
        
        // æ ·å¼è¡¥å……
        const style = document.createElement('style');
        style.textContent = `
            /* æ¨¡æ€æ¡†æ ·å¼ */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }
            
            .modal-content {
                background-color: white;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
                max-width: 600px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            }
            
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
            }
            
            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }
            
            /* è¡¨å•æ ·å¼ */
            .form-group {
                margin-bottom: 20px;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #2d3748;
            }
            
            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }
            
            .form-group input:focus,
            .form-group textarea:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
            .form-group textarea {
                height: 150px;
                resize: vertical;
            }
            
            /* æƒé™è®¾ç½®æ ·å¼ */
            .permissions-section {
                margin-top: 16px;
                margin-bottom: 24px;
            }
            
            .permissions-title {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 16px;
                color: #2d3748;
            }
            
            .permissions-grid {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            
            .permission-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 16px;
                background-color: #f8fafc;
                border: 2px solid #e2e8f0;
                border-radius: 10px;
                transition: all 0.3s ease;
            }
            
            .permission-item:hover {
                background-color: #ffffff;
                border-color: #cbd5e1;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            
            .permission-item input[type="checkbox"] {
                width: 20px;
                height: 20px;
                accent-color: #667eea;
                cursor: pointer;
                flex-shrink: 0;
            }
            
            .permission-item label {
                flex: 1;
                font-size: 14px;
                font-weight: 500;
                color: #4a5568;
                cursor: pointer;
                margin: 0;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>